# Mini-CSS-Extract Plugin

refs:
[[1]](https://webpack.js.org/plugins/mini-css-extract-plugin/)

\
it takes time to extract CSS\
so, don't do it in `dev`,\
only in `prod`

\
install `mini-css-extract-plugin`
```
$ npm i -D mini-css-extract-plugin
```

\
update `webpack.prod.config.js`
```js
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

module.exports = merge(base, {
  mode: "production",
+ plugins: [
+   new MiniCssExtractPlugin ({
+     filename: '[name].css'
+   })
+ ]
});
```

\
move the `rule`\
from `base` to `dev`...

\
that is,\
update `webpack.base.config.js`
```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.jsx?$/i,
        include: SRC_DIR,
        use: ['babel-loader']
      },
-     {
-       test: /\.(css|sass|scss)$/i,
-       include: SRC_DIR,
-       use: [
-         'style-loader', // Creates 'style' nodes from JS strings.
-         'css-loader',   // Translates CSS into CommonJS.
-         'sass-loader'   // Compiles Sass/SCSS to CSS.
-       ],
-     }
    ]
  },
};
```
\
& update `webpack.dev.config.js`
```js
module.exports = merge(base, {
+ module: {
+   rules: [
+     {
+       test: /\.(css|sass|scss)$/i,
+       include: SRC_DIR,
+       use: [
+         'style-loader', // Creates 'style' nodes from JS strings.
+         'css-loader',   // Translates CSS into CommonJS.
+         'sass-loader'   // Compiles Sass/SCSS to CSS.
+       ],
+     }
+   ]
+ }
});
```

\
lastly,\
update `webpack.prod.config.js` again
```js
+ const SRC_DIR = path.resolve(__dirname, 'src');

module.exports = merge(base, {
+ module: {
+   rules: [
+     {
+       test: /\.(css|sass|scss)$/i,
+       include: SRC_DIR,
+       use: [
+         MiniCssExtractPlugin.loader, // Extract CSS into files.
+         'css-loader',                // Translates CSS into CommonJS.
+         'sass-loader'                // Compiles Sass/SCSS to CSS.
+       ],
+     }
+   ]
+ }
});
```

<br>

> p.s.,\
> since webpack v4,\
> the `extract-text-webpack-plugin`\
> should not be used for CSS.\
> use `mini-css-extract-plugin` instead.
>
> refs:
> [[1]](https://webpack.js.org/plugins/extract-text-webpack-plugin)

<br>

# PostCSS (autoprefixer)

> npm i -D autoprefixer postcss-loader

- add postcss.config.js (option 1)

module.exports = {
  plugins: [
    require('autoprefixer')
  ]
};

or

- update package.json (option 2)

"postcss": {
  "plugins": {
    "autoprefixer": {}
  }
},

(I prefer option 2)

- update webpack.config.js

replace

module: {
  rules: [
    ...
    {
      test: /\.(css|sass|scss)$/i,
      use: ExtractTextPlugin.extract ({
        fallback: 'style-loader',
        use: ['css-loader', 'sass-loader']
      }),
      include: SRC_DIR
    }
  ]
}

with

module: {
  rules: [
    ...
    {
      test: /\.(css|sass|scss)$/i,
      use: ExtractTextPlugin.extract ({
        fallback: 'style-loader',
        use: ['css-loader', 'postcss-loader', 'sass-loader']
      }),
      include: SRC_DIR
    }
  ]
}

- update package.json

add

"browserslist": [
  "> 1%",
  "ie > 9"
],

-----

[minify CSS]

there're 2 ways to minify CSS.

1. use css-loader options

- update webpack.config.js

replace

module: {
  rules: [
    ...
    {
      test: /\.(css|sass|scss)$/i,
      use: ExtractTextPlugin.extract ({
        fallback: 'style-loader',
        use: ['css-loader', 'postcss-loader', 'sass-loader']
      }),
      include: SRC_DIR
    },
    ...
  ]
}

with

module: {
  rules: [
    ...
    {
      test: /\.(css|sass|scss)$/i,
      use: ExtractTextPlugin.extract ({
        fallback: 'style-loader',
        use: [
          {
            loader: 'css-loader',
            options: {
              minimize: true
            }
          },
          'postcss-loader',
          'sass-loader'
        ]
      }),
      include: SRC_DIR
    },
    ...
  ]
}

2. use 'webpack -p' in package.json,
where -p switches webpack loaders to minimize mode.

see [build script] below for further explanation.

I prefer solution 2.
